<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="François Leroy">

<title>Practical Class 5: Modeling patterns of biodiversity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="practical_week_5_files/libs/clipboard/clipboard.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/quarto.js"></script>
<script src="practical_week_5_files/libs/quarto-html/popper.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/anchor.min.js"></script>
<link href="practical_week_5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="practical_week_5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="practical_week_5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="practical_week_5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="practical_week_5_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="practical_week_5_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="practical_week_5_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-we-will-do-today" id="toc-what-we-will-do-today" class="nav-link active" data-scroll-target="#what-we-will-do-today">What we will do today</a></li>
  <li><a href="#download-the-north-american-bbs" id="toc-download-the-north-american-bbs" class="nav-link" data-scroll-target="#download-the-north-american-bbs">Download the North American BBS</a></li>
  <li><a href="#explore-the-metadata" id="toc-explore-the-metadata" class="nav-link" data-scroll-target="#explore-the-metadata">Explore the metadata</a></li>
  <li><a href="#map-the-bbs" id="toc-map-the-bbs" class="nav-link" data-scroll-target="#map-the-bbs">Map the BBS</a></li>
  <li><a href="#compute-map-and-model-species-richness" id="toc-compute-map-and-model-species-richness" class="nav-link" data-scroll-target="#compute-map-and-model-species-richness">Compute map and model species richness</a>
  <ul class="collapse">
  <li><a href="#compute" id="toc-compute" class="nav-link" data-scroll-target="#compute">Compute</a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">Map</a></li>
  <li><a href="#modeling-species-richness-using-linear-regressions" id="toc-modeling-species-richness-using-linear-regressions" class="nav-link" data-scroll-target="#modeling-species-richness-using-linear-regressions">Modeling species richness using linear regressions</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical Class 5: Modeling patterns of biodiversity</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>François Leroy </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="what-we-will-do-today" class="level1">
<h1>What we will do today</h1>
</section>
<section id="download-the-north-american-bbs" class="level1">
<h1>Download the North American BBS</h1>
<p><a href="https://www.pwrc.usgs.gov/bbs/">The North American BBS</a> is an open source dataset that you can dowload directly <a href="https://www.sciencebase.gov/catalog/item/52b1dfa8e4b0d9b325230cd9">here</a>. In <code>Child Items</code>, click <code>2022 Release - North American Breeding Bird Survey Dataset (1966-2021)</code> and under <code>Attached Files</code>, click on <code>download all</code>. The download should start few seconds after. Save the <code>.zip</code> archive into a <code>data</code> folder that you created in your working directory.</p>
<p>Now, unzip and erase the <code>2022Release_Nor.zip</code>. Then, unzip all the <code>.zip</code> archives left.</p>
</section>
<section id="explore-the-metadata" class="level1">
<h1>Explore the metadata</h1>
<p><a href="https://en.wikipedia.org/wiki/Metadata#:~:text=Metadata%20is%20%22data%20that%20provides,used%20for%20discovery%20and%20identification.">Metadata</a> are information about the dataset you are using, but not the data itself. When dealing with a large dataset, it often comes with a metadata file showing you the structure of the data. Here, we have an <code>.xml</code> file: <code>North American Breeding Bird Survey Dataset (1966-2021).xml</code>. To simply visualize it, drag and drop this file into your browser (firefox, google…). Explore the structure of this file. Keep this tab open as you will have to come back to it throughout this practical work.</p>
</section>
<section id="map-the-bbs" class="level1">
<h1>Map the BBS</h1>
<p>Let’s visualize the spatial coverage of the dataset. Information about the roads can be found in the <code>road.csv</code> file. First, explore the metadata file that you previously opened in your browser and find the information about the <code>road.csv</code> file.</p>
<ul>
<li>Now, let’s load the file:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="do">## Clear the environment when running the script</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>routes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data/routes.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(routes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  CountryNum StateNum Route       RouteName Active Latitude Longitude Stratum
1        840        2     1      ST FLORIAN      1 34.86869 -87.60414      14
2        840        2     2       HILLSBORO      0 34.63867 -87.19129      14
3        840        2     3        FLORENCE      0 34.80000 -87.73333      14
4        840        2     4           TRADE      1 34.02979 -87.05924      13
5        840        2     5         SUMMITT      0 34.20167 -86.49341      13
6        840        2     6 VALHERMOSO SPGS      0 34.50129 -86.68555      14
  BCR RouteTypeID RouteTypeDetailID
1  27           1                 1
2  24           1                 1
3  24           1                 1
4  28           1                 1
5  28           1                 1
6  24           1                 1</code></pre>
</div>
</div>
<ul>
<li>In order to map the data contained into this file, we need to convert it into a shapefile:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create your own CRS for North America</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>crs_NA <span class="ot">&lt;-</span> <span class="st">"+proj=laea +lon_0=-68.91 +lat_0=1.28 +datum=WGS84 +units=m +no_defs"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Transform the dataframe into an sf object</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(routes, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="do">## specify the columns containing the longitude and latitude</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="dv">4326</span>) <span class="do">## specify the CRS of the data </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Set the crs to the one created above</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> routes_shp <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_NA)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(routes_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -1788418 ymin: 3623076 xmax: -1681314 ymax: 3715916
CRS:           +proj=laea +lon_0=-68.91 +lat_0=1.28 +datum=WGS84 +units=m +no_defs
  CountryNum StateNum Route       RouteName Active Stratum BCR RouteTypeID
1        840        2     1      ST FLORIAN      1      14  27           1
2        840        2     2       HILLSBORO      0      14  24           1
3        840        2     3        FLORENCE      0      14  24           1
4        840        2     4           TRADE      1      13  28           1
5        840        2     5         SUMMITT      0      13  28           1
6        840        2     6 VALHERMOSO SPGS      0      14  24           1
  RouteTypeDetailID                 geometry
1                 1 POINT (-1775125 3715916)
2                 1 POINT (-1740168 3689054)
3                 1 POINT (-1788418 3709264)
4                 1 POINT (-1737600 3623076)
5                 1 POINT (-1681314 3638605)
6                 1 POINT (-1694739 3671693)</code></pre>
</div>
</div>
<p>You can see that the colmuns <code>Latitude</code> and <code>Longitude</code> have been replaced by a single column <code>geometry</code> (which contains the shapefile data)</p>
<ul>
<li>Now let’s map it:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## You need to load the background map from the rnaturalearth package</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>countries_shp <span class="ot">&lt;-</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"North America"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_NA)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Map it</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_shp)<span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_shp, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="compute-map-and-model-species-richness" class="level1">
<h1>Compute map and model species richness</h1>
<p>Species richness represents the total number of species at one location. It is one of the most commonly used metric of biodiversity as it is really straight forward to assess it. Data about the species can be found in folder <code>50-StopData/1997ToPresent_SurveyWide/</code>. They are spread on 10 excel spreadsheets (<em>do not forget to unzip them !!</em>). In order to not repeat 10 times the loading process, we will automate it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Get the file names</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/50-StopData/1997ToPresent_SurveyWide/"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">full.names =</span> T)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the dataframe that will contain the data</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop over each file</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(file_list)){</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Load the file and temporary store it</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_list[i])</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Bind to the species dataframe</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  species <span class="ot">&lt;-</span> <span class="fu">rbind</span>(species, d)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Remove the temporary data</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(d)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; "><table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RouteDataID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> CountryNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StateNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Route </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RPID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Year </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> AOU </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop1 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop2 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop3 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop4 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop5 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop6 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop7 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop8 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop9 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop10 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop11 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop12 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop13 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop14 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop15 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop16 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop17 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop18 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop19 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop20 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop21 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop22 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop23 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop24 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop25 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop26 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop27 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop28 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop29 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop30 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop31 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop32 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop33 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop34 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop35 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop36 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop37 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop38 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop39 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop40 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop41 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop42 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop43 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop44 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop45 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop46 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop47 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop48 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop49 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop50 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00530 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00534 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00540 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00590 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 01200 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 01320 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
<p><br></p>
<p><strong>In the .xml file: find what does mean the <code>RouteDataID</code> and <code>AOU</code> columns refer to.</strong></p>
<section id="compute" class="level2">
<h2 class="anchored" data-anchor-id="compute">Compute</h2>
<p>We are going to compute and display the avian species richness of each road for the year 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's filter the species datafram for the year 2019</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Here I provide 2 ways of doing it: either base R or tidyverse</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sp2019 <span class="ot">&lt;-</span> species[species<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2019</span>,]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sp2019 <span class="ot">&lt;-</span> species <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">### As it is written in the metadata. The species are given in the column AOU. </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Thus, for each value of RouteDataID, we are going to assess the number of AOU</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that the AOU appears only if the species has been observed once in the 50 points</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>sr2019 <span class="ot">&lt;-</span> sp2019 <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RouteDataID) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sr_2019 =</span> <span class="fu">length</span>(<span class="fu">unique</span>(AOU)),   <span class="do">## Compute species richness</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">CountryNum =</span> <span class="fu">unique</span>(CountryNum), <span class="do">## Keep the route info</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">StateNum =</span> <span class="fu">unique</span>(StateNum),     <span class="do">## Keep the route info</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">Route =</span> <span class="fu">unique</span>(Route))           <span class="do">## Keep the route info</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sr2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 5
  RouteDataID sr_2019 CountryNum StateNum Route
        &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;
1     6370730      49        840 06       170  
2     6370731      50        840 06       074  
3     6370732      33        840 06       024  
4     6370733      35        840 14       049  
5     6370734      49        840 14       089  
6     6370735      42        840 25       131  </code></pre>
</div>
</div>
</section>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">Map</h2>
<p>In order to map the species richness, we need to add it to the object <code>routes_shp</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The class() of the coulmns StateNum and Route must be the same between the 2 datasets:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sr2019 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sr2019, <span class="at">StateNum =</span> <span class="fu">as.numeric</span>(StateNum),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Route =</span> <span class="fu">as.numeric</span>(Route))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Merge the 2 datasets using left join</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(routes_shp, sr2019, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CountryNum"</span>, <span class="st">"StateNum"</span>, <span class="st">"Route"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now that you have computed the species richness, try to map it by adding it to the map we made at the beginning of the class</strong></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modeling-species-richness-using-linear-regressions" class="level2">
<h2 class="anchored" data-anchor-id="modeling-species-richness-using-linear-regressions">Modeling species richness using linear regressions</h2>
<p>Linear regression is the most iconic machine learning method. The main assumption is that there is a linear relationship between the variable you want to predict (<em>a.k.a.</em> the target, the predicted variable, the output) and a set of predictors (<em>a.k.a.</em> covariates, features).</p>
<p>The relationship has a form of a linear function:</p>
<p><span class="math display">\[y = \beta _1x_1 + \beta _2x_2 \ldots \beta _nx_n + \beta _0\]</span></p>
<p>With <span class="math inline">\(n\)</span> the number of covariates. Thus, <span class="math inline">\(y\)</span> can be represented in an (n+1)-dimensional space (called an hyperspace when <span class="math inline">\(n+1 &gt; 3\)</span>). The goal of fitting a linear regression (but also of most of the machine learning algorithms) is to find the hyperplane which fits the most to <span class="math inline">\(y\)</span> (<em>i.e.</em> which explains most of the variance). In machine learning, you do so by minimizing a <em>loss function</em>. The loss function for a linear regression is called the <strong>Residual Sum of Square</strong> (<em>i.e.&nbsp;RSS</em>).</p>
<p><span class="math display">\[RSS = \sum _{i = 1}^n (y_i - \hat y_i)^2\]</span></p>
<p>Here, we will use weather data as covariates (<span class="math inline">\(x_1\ldots x_n\)</span>) in order to predict the species richness for year 2019 (<span class="math inline">\(y\)</span>). Weather data is stored in the <code>weather.csv</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/weather.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; "><table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RouteDataID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> CountryNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StateNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Route </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RPID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Year </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Month </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Day </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> ObsN </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> TotalSpp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StartTemp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> EndTemp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> TempScale </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> StartWind </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> EndWind </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> StartSky </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> EndSky </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StartTime </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> EndTime </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Assistant </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> QualityCurrentID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RunType </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 6174482 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1972 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:left;"> 65 </td>
   <td style="text-align:left;"> 60 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 0450 </td>
   <td style="text-align:left;"> 0900 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6178138 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1973 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 41 </td>
   <td style="text-align:left;"> 65 </td>
   <td style="text-align:left;"> 67 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0915 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6179521 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1974 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:left;"> 37 </td>
   <td style="text-align:left;"> 58 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0448 </td>
   <td style="text-align:left;"> 0921 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6180286 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1975 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 53 </td>
   <td style="text-align:left;"> 56 </td>
   <td style="text-align:left;"> 56 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0451 </td>
   <td style="text-align:left;"> 0923 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6179841 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1976 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:left;"> 38 </td>
   <td style="text-align:left;"> 63 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0920 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6184392 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1978 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1190190 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:left;"> 55 </td>
   <td style="text-align:left;"> 62 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0932 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
<p><br></p>
<p><strong>Have a look at the definitions of the columns in the metadata file and try to assess which covariates would be worth to use in our model.</strong></p>
<p>We will use the following covariates:</p>
<ul>
<li>Month</li>
<li>Temperature</li>
<li>Wind condition</li>
<li>Time of the day</li>
</ul>
<p>However, as you can see, the temperature, wind condition and time of the day need processing before fitting the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First we need to convert temperature and time of the day to numeric</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTemp =</span> <span class="fu">as.numeric</span>(StartTemp),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EndTemp =</span> <span class="fu">as.numeric</span>(EndTemp),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTime =</span> <span class="fu">as.numeric</span>(StartTime),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EndTime =</span> <span class="fu">as.numeric</span>(EndTime))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## We also need to homogenize the temperature to degree Celsius </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTemp =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                   TempScale <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> ((StartTemp <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> StartTemp</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">EndTemp =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                   TempScale <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> ((EndTemp <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> EndTemp</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                 ))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's compute the average temperature for the road #####</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>avgTemp <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rowMeans</span>(weather[,<span class="fu">c</span>(<span class="st">"StartTemp"</span>,<span class="st">"EndTemp"</span>)], <span class="at">na.rm =</span> T),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The wind condition is a semi-continuous variable. Each increasing level indicates a stronger wind level. Thus, we can take the average number between the start and end of the road. However, the number 9 indicates a lack of data. Thus, we can replace 9 by <code>NA</code> as follow:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>StartWind[weather<span class="sc">$</span>StartWind <span class="sc">==</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>EndWind[weather<span class="sc">$</span>EndWind <span class="sc">==</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now that the weather columns are prepared, compute the average number for the wind condition. Watch out: we do not want decimals!!</strong></p>
<div class="cell">

</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>