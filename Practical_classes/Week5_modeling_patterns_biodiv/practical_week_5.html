<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="François Leroy">

<title>Practical Class 5: Modeling patterns of biodiversity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="practical_week_5_files/libs/clipboard/clipboard.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/quarto.js"></script>
<script src="practical_week_5_files/libs/quarto-html/popper.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="practical_week_5_files/libs/quarto-html/anchor.min.js"></script>
<link href="practical_week_5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="practical_week_5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="practical_week_5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="practical_week_5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="practical_week_5_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="practical_week_5_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="practical_week_5_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#download-the-north-american-bbs" id="toc-download-the-north-american-bbs" class="nav-link active" data-scroll-target="#download-the-north-american-bbs">Download the North American BBS</a></li>
  <li><a href="#explore-the-metadata" id="toc-explore-the-metadata" class="nav-link" data-scroll-target="#explore-the-metadata">Explore the metadata</a></li>
  <li><a href="#map-the-bbs" id="toc-map-the-bbs" class="nav-link" data-scroll-target="#map-the-bbs">Map the BBS</a></li>
  <li><a href="#compute-map-and-model-species-richness" id="toc-compute-map-and-model-species-richness" class="nav-link" data-scroll-target="#compute-map-and-model-species-richness">Compute map and model species richness</a>
  <ul class="collapse">
  <li><a href="#compute" id="toc-compute" class="nav-link" data-scroll-target="#compute">Compute</a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">Map</a></li>
  <li><a href="#model-species-richness-using-linear-regressions" id="toc-model-species-richness-using-linear-regressions" class="nav-link" data-scroll-target="#model-species-richness-using-linear-regressions">Model species richness using linear regressions</a></li>
  </ul></li>
  <li><a href="#exercice-modeling-shannon-index-and-evenness" id="toc-exercice-modeling-shannon-index-and-evenness" class="nav-link" data-scroll-target="#exercice-modeling-shannon-index-and-evenness">Exercice: modeling Shannon index and evenness</a>
  <ul class="collapse">
  <li><a href="#now-it-is-up-to-you" id="toc-now-it-is-up-to-you" class="nav-link" data-scroll-target="#now-it-is-up-to-you">Now it is up to you</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical Class 5: Modeling patterns of biodiversity</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>François Leroy </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p><strong>Content of the practical work of today:</strong></p>
<p>The point of this class is to put you in the situation where you have to download, explore and exploit a large biodiversity dataset. It is made to show you the steps that you are likely to follow when you are working with macroecological datasets. We will work with one of the most famous and qualitative dataset in ecology: the North American Breeding Bird Survey (BBS).</p>
<p>The steps are as follow:</p>
<ol type="1">
<li>Download the data and set up your R environment</li>
<li>Explore the data through metadata</li>
<li>Map the spatial extent of your dataset</li>
<li>Assess and map the avian species richness for the year 2019</li>
<li>Fit a linear model to predict species richness using a set of predictors</li>
</ol>
<p>Finally, the last part of the workshop will be for you to use the tools we used during the class to work on two other metrics of biodiversity: the Shannon index (<em>i.e.</em> diversity) and the Pielou index (<em>i.e.</em> evenness).</p>
<section id="download-the-north-american-bbs" class="level1">
<h1>Download the North American BBS</h1>
<p><a href="https://www.pwrc.usgs.gov/bbs/">The North American BBS</a> is an open source dataset that you can dowload directly <a href="https://www.sciencebase.gov/catalog/item/52b1dfa8e4b0d9b325230cd9">here</a>. In <code>Child Items</code>, click <code>2022 Release - North American Breeding Bird Survey Dataset (1966-2021)</code> and under <code>Attached Files</code>, click on <code>download all</code>. The download should start few seconds after. Save the <code>.zip</code> archive into a <code>data</code> folder that you created in your working directory.</p>
<p>Now, unzip and erase the <code>2022Release_Nor.zip</code>. Then, unzip all the <code>.zip</code> archives left.</p>
</section>
<section id="explore-the-metadata" class="level1">
<h1>Explore the metadata</h1>
<p><a href="https://en.wikipedia.org/wiki/Metadata#:~:text=Metadata%20is%20%22data%20that%20provides,used%20for%20discovery%20and%20identification.">Metadata</a> are information about the dataset you are using, but not the data itself. When dealing with a large dataset, it often comes with a metadata file showing you the structure of the data. Here, we have an <code>.xml</code> file: <code>North American Breeding Bird Survey Dataset (1966-2021).xml</code>. To simply visualize it, drag and drop this file into your browser (firefox, google…). Explore the structure of this file. Keep this tab open as you will have to come back to it throughout this practical work.</p>
</section>
<section id="map-the-bbs" class="level1">
<h1>Map the BBS</h1>
<p>Let’s visualize the spatial coverage of the dataset. Information about the roads can be found in the <code>road.csv</code> file. First, explore the metadata file that you previously opened in your browser and find the information about the <code>road.csv</code> file.</p>
<ul>
<li>Now, let’s load the file:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="do">## Clear the environment when running the script</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>routes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data/routes.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(routes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  CountryNum StateNum Route       RouteName Active Latitude Longitude Stratum
1        840        2     1      ST FLORIAN      1 34.86869 -87.60414      14
2        840        2     2       HILLSBORO      0 34.63867 -87.19129      14
3        840        2     3        FLORENCE      0 34.80000 -87.73333      14
4        840        2     4           TRADE      1 34.02979 -87.05924      13
5        840        2     5         SUMMITT      0 34.20167 -86.49341      13
6        840        2     6 VALHERMOSO SPGS      0 34.50129 -86.68555      14
  BCR RouteTypeID RouteTypeDetailID
1  27           1                 1
2  24           1                 1
3  24           1                 1
4  28           1                 1
5  28           1                 1
6  24           1                 1</code></pre>
</div>
</div>
<ul>
<li>In order to map the data contained into this file, we need to convert it into a shapefile:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create your own CRS for North America</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>crs_NA <span class="ot">&lt;-</span> <span class="st">"+proj=laea +lon_0=-68.91 +lat_0=1.28 +datum=WGS84 +units=m +no_defs"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Transform the dataframe into an sf object</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(routes,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="do">## specify the columns containing the longitude and latitude</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="dv">4326</span>) <span class="do">## specify the CRS of the data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Set the crs to the one created above</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> routes_shp <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_NA)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(routes_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -1788418 ymin: 3623076 xmax: -1681314 ymax: 3715916
CRS:           +proj=laea +lon_0=-68.91 +lat_0=1.28 +datum=WGS84 +units=m +no_defs
  CountryNum StateNum Route       RouteName Active Stratum BCR RouteTypeID
1        840        2     1      ST FLORIAN      1      14  27           1
2        840        2     2       HILLSBORO      0      14  24           1
3        840        2     3        FLORENCE      0      14  24           1
4        840        2     4           TRADE      1      13  28           1
5        840        2     5         SUMMITT      0      13  28           1
6        840        2     6 VALHERMOSO SPGS      0      14  24           1
  RouteTypeDetailID                 geometry
1                 1 POINT (-1775125 3715916)
2                 1 POINT (-1740168 3689054)
3                 1 POINT (-1788418 3709264)
4                 1 POINT (-1737600 3623076)
5                 1 POINT (-1681314 3638605)
6                 1 POINT (-1694739 3671693)</code></pre>
</div>
</div>
<p>You can see that the colmuns <code>Latitude</code> and <code>Longitude</code> have been replaced by a single column <code>geometry</code> (which contains the shapefile data)</p>
<ul>
<li>Now let’s map it:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## You need to load the background map from the rnaturalearth package</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>countries_shp <span class="ot">&lt;-</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"North America"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_NA)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Map it</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_shp)<span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> routes_shp, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="compute-map-and-model-species-richness" class="level1">
<h1>Compute map and model species richness</h1>
<p>Species richness represents the total number of species at one location. It is one of the most commonly used metric of biodiversity as it is really straight forward to assess. Data about the species can be found in folder <code>50-StopData/1997ToPresent_SurveyWide/</code>. They are spread on 10 excel spreadsheets (<em>do not forget to unzip them !!</em>). In order to not repeat 10 times the loading process, we will automate it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Get the file names</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/50-StopData/1997ToPresent_SurveyWide/"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">full.names =</span> T)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Create the dataframe that will contain the data</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop over each file</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(file_list)){</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Load the file and temporary store it</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_list[i])</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Bind to the species dataframe</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  species <span class="ot">&lt;-</span> <span class="fu">rbind</span>(species, d)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Remove the temporary data</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(d)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; "><table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RouteDataID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> CountryNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StateNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Route </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RPID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Year </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> AOU </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop1 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop2 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop3 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop4 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop5 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop6 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop7 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop8 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop9 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop10 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop11 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop12 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop13 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop14 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop15 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop16 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop17 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop18 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop19 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop20 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop21 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop22 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop23 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop24 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop25 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop26 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop27 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop28 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop29 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop30 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop31 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop32 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop33 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop34 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop35 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop36 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop37 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop38 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop39 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop40 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop41 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop42 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop43 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop44 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop45 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop46 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop47 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop48 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop49 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Stop50 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00530 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00534 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00540 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 00590 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 01200 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6167164 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:left;"> 01320 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
<p><br></p>
<p><strong>In the .xml file: find what does mean the <code>RouteDataID</code> and <code>AOU</code> columns refer to.</strong></p>
<section id="compute" class="level2">
<h2 class="anchored" data-anchor-id="compute">Compute</h2>
<p>We are going to compute and display the avian species richness of each road for the year 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's filter the species datafram for the year 2019</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Here I provide 2 ways of doing it: either base R or tidyverse</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sp2019 <span class="ot">&lt;-</span> species[species<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2019</span>,]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sp2019 <span class="ot">&lt;-</span> species <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">### As it is written in the metadata. The species are given in the column AOU.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Thus, for each value of RouteDataID, we are going to assess the number of AOU</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that the AOU appears only if the species has been observed once in the 50 points</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>sr2019 <span class="ot">&lt;-</span> sp2019 <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RouteDataID) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sr_2019 =</span> <span class="fu">length</span>(<span class="fu">unique</span>(AOU)),   <span class="do">## Compute species richness</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">CountryNum =</span> <span class="fu">unique</span>(CountryNum), <span class="do">## Keep the route info</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">StateNum =</span> <span class="fu">unique</span>(StateNum),     <span class="do">## Keep the route info</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">Route =</span> <span class="fu">unique</span>(Route))           <span class="do">## Keep the route info</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sr2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  RouteDataID sr_2019 CountryNum StateNum Route
        &lt;dbl&gt;   &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;
1     6370730      49        840 06       170  
2     6370731      50        840 06       074  
3     6370732      33        840 06       024  
4     6370733      35        840 14       049  
5     6370734      49        840 14       089  
6     6370735      42        840 25       131  </code></pre>
</div>
</div>
</section>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">Map</h2>
<p>In order to map the species richness, we need to add it to the object <code>routes_shp</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The class() of the coulmns StateNum and Route must be the same between the 2 datasets:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sr2019 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sr2019, <span class="at">StateNum =</span> <span class="fu">as.numeric</span>(StateNum),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Route =</span> <span class="fu">as.numeric</span>(Route))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Merge the 2 datasets using left join</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>routes_shp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(routes_shp, sr2019,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CountryNum"</span>, <span class="st">"StateNum"</span>, <span class="st">"Route"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now that you have computed the species richness, try to map it by adding it to the map we made at the beginning of the class</strong></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-species-richness-using-linear-regressions" class="level2">
<h2 class="anchored" data-anchor-id="model-species-richness-using-linear-regressions">Model species richness using linear regressions</h2>
<p>Linear regression is the most iconic machine learning method. The main assumption is that there is a linear relationship between the variable you want to predict (<em>a.k.a.</em> the target, the predicted variable, the output) and a set of predictors (<em>a.k.a.</em> covariates, features).</p>
<p>The relationship has a form of a linear function:</p>
<p><span class="math display">\[y = \beta _1x_1 + \beta _2x_2 \ldots \beta _nx_n + \beta _0\]</span></p>
<p>With <span class="math inline">\(n\)</span> the number of covariates. Thus, <span class="math inline">\(y\)</span> can be represented in an (n+1)-dimensional space (called an hyperspace when <span class="math inline">\(n+1 &gt; 3\)</span>). The goal of fitting a linear regression (but also of most of the machine learning algorithms) is to find the hyperplane which fits the most to <span class="math inline">\(y\)</span> (<em>i.e.</em> which explains most of the variance). In machine learning, you do so by minimizing a <em>loss function</em>. The loss function for a linear regression is called the <strong>Residual Sum of Square</strong> (<em>i.e.&nbsp;RSS</em>).</p>
<p><span class="math display">\[RSS = \sum _{i = 1}^n (y_i - \hat y_i)^2\]</span></p>
<p>Here, we will use weather data as covariates (<span class="math inline">\(x_1\ldots x_n\)</span>) in order to predict the species richness for year 2019 (<span class="math inline">\(y\)</span>). Weather data is stored in the <code>weather.csv</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/weather.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; "><table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RouteDataID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> CountryNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StateNum </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Route </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RPID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Year </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Month </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> Day </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> ObsN </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> TotalSpp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StartTemp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> EndTemp </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> TempScale </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> StartWind </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> EndWind </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> StartSky </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> EndSky </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> StartTime </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> EndTime </th>
   <th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"> Assistant </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> QualityCurrentID </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> RunType </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 6174482 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1972 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:left;"> 65 </td>
   <td style="text-align:left;"> 60 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 0450 </td>
   <td style="text-align:left;"> 0900 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6178138 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1973 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 41 </td>
   <td style="text-align:left;"> 65 </td>
   <td style="text-align:left;"> 67 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0915 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6179521 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1974 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:left;"> 37 </td>
   <td style="text-align:left;"> 58 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0448 </td>
   <td style="text-align:left;"> 0921 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6180286 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1975 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 53 </td>
   <td style="text-align:left;"> 56 </td>
   <td style="text-align:left;"> 56 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0451 </td>
   <td style="text-align:left;"> 0923 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6179841 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1976 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 1150175 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:left;"> 38 </td>
   <td style="text-align:left;"> 63 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0920 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6184392 </td>
   <td style="text-align:right;"> 124 </td>
   <td style="text-align:left;"> 04 </td>
   <td style="text-align:left;"> 001 </td>
   <td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 1978 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1190190 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:left;"> 55 </td>
   <td style="text-align:left;"> 62 </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 0444 </td>
   <td style="text-align:left;"> 0932 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
<p><br></p>
<p><strong>Have a look at the definitions of the columns in the metadata file and try to assess which covariates would be worth to use in our model.</strong></p>
<p>We will use the following covariates:</p>
<ul>
<li>Month</li>
<li>Temperature</li>
<li>Wind condition</li>
<li>Time of the day</li>
<li>Sky conditions</li>
</ul>
<p>However, as you can see, the temperature, wind condition and time of the day need processing before fitting the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First we need to convert temperature and time of the day to numeric</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTemp =</span> <span class="fu">as.numeric</span>(StartTemp),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EndTemp =</span> <span class="fu">as.numeric</span>(EndTemp),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTime =</span> <span class="fu">as.numeric</span>(StartTime),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EndTime =</span> <span class="fu">as.numeric</span>(EndTime))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## We also need to homogenize the temperature to degree Celsius</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">mutate</span>(weather,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">StartTemp =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                   TempScale <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> ((StartTemp <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> StartTemp</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">EndTemp =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                   TempScale <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> ((EndTemp <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> EndTemp</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                 ))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, let's compute the average temperature for the road #####</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>avgTemp <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rowMeans</span>(weather[,<span class="fu">c</span>(<span class="st">"StartTemp"</span>,<span class="st">"EndTemp"</span>)], <span class="at">na.rm =</span> T),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The wind condition is an ordinal variable. Each increasing level indicates a stronger wind level. Thus, we can take the average number between the start and end of the road. However, the number 9 indicates a lack of data. Thus, we can replace 9 by <code>NA</code> as follow:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>StartWind[weather<span class="sc">$</span>StartWind <span class="sc">==</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>EndWind[weather<span class="sc">$</span>EndWind <span class="sc">==</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now that the weather columns are prepared, compute the average number for the wind condition. Watch out: we do not want decimals!!</strong></p>
<div class="cell">

</div>
<p>The last covariate: the time of the day. We are going to convert it into decimal hours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="do">## the best package to work with date/time formats in R</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## First we need to modify how the hour is given: we will add ":" between hour:minutes</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>StartTime <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">'^([0-9]{1,2})([0-9]{2})$'</span>, <span class="st">'</span><span class="sc">\\</span><span class="st">1:</span><span class="sc">\\</span><span class="st">2'</span> ,weather<span class="sc">$</span>StartTime)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>EndTime <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">'^([0-9]{1,2})([0-9]{2})$'</span>, <span class="st">'</span><span class="sc">\\</span><span class="st">1:</span><span class="sc">\\</span><span class="st">2'</span> ,weather<span class="sc">$</span>EndTime)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## And convert it to a date format (almost always needed to work with date/time data)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>StartTime <span class="ot">&lt;-</span> <span class="fu">hm</span>(weather<span class="sc">$</span>StartTime)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>EndTime <span class="ot">&lt;-</span> <span class="fu">hm</span>(weather<span class="sc">$</span>EndTime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can check the class of the columns</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(weather<span class="sc">$</span>EndTime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Period"
attr(,"package")
[1] "lubridate"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We can now convert it to decimal hours</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>StartTime <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">hour</span>(weather<span class="sc">$</span>StartTime) <span class="sc">+</span> (<span class="fu">minute</span>(weather<span class="sc">$</span>StartTime)<span class="sc">/</span><span class="dv">60</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">2</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>EndTime <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">hour</span>(weather<span class="sc">$</span>EndTime) <span class="sc">+</span> (<span class="fu">minute</span>(weather<span class="sc">$</span>EndTime)<span class="sc">/</span><span class="dv">60</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Now that you have <code>StartTime</code> and <code>EndTime</code> in decimal hours: create a new column <code>avgTime</code> which contains the mean hour of the day at which the census has been made (with 2 decimals).</strong></p>
<div class="cell">

</div>
<p>Concerning the <code>Sky</code> covariate, it is a cotegorical variable, and we can’t average it. Thus, we will use the <code>StartSky</code> covariate. Here it is: we have the 5 covariates that we will use to model species richness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Frst we can filter the weather data to only keep the info for 2019</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather[weather<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2019</span>,]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## You can see that now you have as many rows in weather than in sr2019</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to join the species richness to the weather data using the road/census ID</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>lm_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sr2019, weather, <span class="at">by =</span> <span class="st">"RouteDataID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sr_2019, avgTemp, avgTime, avgWind, StartSky, Month) <span class="do">## and keep only the covariates and target</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look at the classes of the data</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(lm_data, class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sr_2019   avgTemp   avgTime   avgWind  StartSky     Month 
"integer" "numeric" "numeric" "numeric" "numeric" "numeric" </code></pre>
</div>
</div>
<p>You can see that all the columns are into an integer or numeric format. This is problematic for the 3 covariates which are qualitative: namely <code>avgWind</code> (qualitative ordinal), <code>Month</code> (qualitative nominal) and <code>StartSky</code> (qualitative nominal). Let’s modify them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lm_data<span class="sc">$</span>StartSky <span class="ot">&lt;-</span> <span class="fu">factor</span>(lm_data<span class="sc">$</span>StartSky)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>lm_data<span class="sc">$</span>Month <span class="ot">&lt;-</span> <span class="fu">factor</span>(lm_data<span class="sc">$</span>Month)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>lm_data<span class="sc">$</span>avgWind <span class="ot">&lt;-</span> <span class="fu">factor</span>(lm_data<span class="sc">$</span>avgWind, <span class="at">order =</span> T)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look at the classes of the data</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lm_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [3,239 × 6] (S3: tbl_df/tbl/data.frame)
 $ sr_2019 : int [1:3239] 49 50 33 35 49 42 21 28 42 70 ...
 $ avgTemp : num [1:3239] 17.2 25 23.6 17.8 21.9 ...
 $ avgTime : num [1:3239] 7.06 7.38 7.28 7.14 7.37 8.14 8.11 7.16 8.66 8.25 ...
 $ avgWind : Ord.factor w/ 6 levels "0"&lt;"1"&lt;"2"&lt;"3"&lt;..: 1 1 2 1 3 2 3 2 3 4 ...
 $ StartSky: Factor w/ 6 levels "0","1","2","4",..: 1 1 1 1 1 2 1 3 4 3 ...
 $ Month   : Factor w/ 4 levels "4","5","6","7": 1 1 1 2 2 2 1 2 2 2 ...</code></pre>
</div>
</div>
<p>We can now learn the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr_2019 <span class="sc">~</span> ., <span class="at">data =</span> lm_data) <span class="do">## modeling sr_2019 as a function of all the other variables</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sr_2019 ~ ., data = lm_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-49.713  -9.211   0.738   9.564  47.335 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 18.25043    5.78575   3.154 0.001623 ** 
avgTemp      0.08629    0.04907   1.758 0.078784 .  
avgTime      1.21006    0.43300   2.795 0.005227 ** 
avgWind.L   -8.39176    4.15407  -2.020 0.043452 *  
avgWind.Q   -2.11181    3.78027  -0.559 0.576447    
avgWind.C    0.05343    2.79287   0.019 0.984739    
avgWind^4   -0.81623    1.81940  -0.449 0.653730    
avgWind^5   -0.87209    1.17428  -0.743 0.457744    
StartSky1   -0.55855    0.60961  -0.916 0.359608    
StartSky2   -0.64338    0.61249  -1.050 0.293599    
StartSky4    3.08333    1.42940   2.157 0.031073 *  
StartSky5   -2.73535    2.02145  -1.353 0.176098    
StartSky8   -9.15008    3.95125  -2.316 0.020635 *  
Month5      19.15574    4.86598   3.937 8.44e-05 ***
Month6      20.97773    4.83203   4.341 1.46e-05 ***
Month7      17.92708    4.89680   3.661 0.000255 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.59 on 3223 degrees of freedom
Multiple R-squared:  0.02665,   Adjusted R-squared:  0.02212 
F-statistic: 5.882 on 15 and 3223 DF,  p-value: 3.264e-12</code></pre>
</div>
</div>
<p><strong>Now, let’s interpret the output of the model</strong></p>
</section>
</section>
<section id="exercice-modeling-shannon-index-and-evenness" class="level1">
<h1>Exercice: modeling Shannon index and evenness</h1>
<p>The goal of this exercise will be to fit a linear model to an other index of diversity: the Shannon index <span class="math inline">\(H\)</span>. This index takes into account both the species richness (that we worked on just before) and the evenness (<em>i.e.</em> relative abundance between the species). It is defined as follow:</p>
<p><span class="math display">\[H = -\sum_i^R p_i\ln p_i\]</span></p>
<p>With <span class="math inline">\(R\)</span> the total number of species and <span class="math inline">\(p_i\)</span> the proportion of individuals. For each species<span class="math inline">\(_i\)</span> with <span class="math inline">\(n_i\)</span> individuals, <span class="math inline">\(p_i = \frac{n_i}{N}\)</span> (with <span class="math inline">\(N\)</span> the total number of individuals)</p>
<p>We are going to compute the Shannon index for the year 2019. For this, we will use the function <code>diversity()</code> from the <code>vegan</code> package.</p>
<p>First, let’s format the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the total abundance for each road and each species</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sp2019<span class="sc">$</span>abundance <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(sp2019[,<span class="dv">8</span><span class="sc">:</span><span class="dv">57</span>])</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="do">## The diversity function needs a dataset formated as: roads x species</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>abundance2019 <span class="ot">&lt;-</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  sp2019 <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RouteDataID, AOU, abundance) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"AOU"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">"abundance"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"RouteDataID"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(abundance2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3239  635</code></pre>
</div>
</div>
<p>You can see that we have 3239 roads and 635 species.</p>
<section id="now-it-is-up-to-you" class="level2">
<h2 class="anchored" data-anchor-id="now-it-is-up-to-you">Now it is up to you</h2>
<ul>
<li><strong>Task 1:</strong> Compute the shannon index using the <code>diversity()</code> function. You should obtain a named vector which looks like this (using <code>head()</code>)</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> 6373601  6372761  6373631  6371445  6370923  6373980 
2.953908 2.793323 3.400513 3.480730 3.223389 3.074759 </code></pre>
</div>
</div>
<ul>
<li><strong>Task 2:</strong> using the <code>left_join()</code> function, try to merge the computed shannon index to <code>sr2019</code> dataframe then to the <code>routes_shp</code> dataframe. <em>Hint:</em> you can use the <code>rownames_to_column()</code> on the shannon vector.</li>
</ul>
<div class="cell">

</div>
<ul>
<li><strong>Task 3:</strong> Map it! You should obtain something like this. You can also compare this map to the species richness map</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><strong>Task 4:</strong> use the <code>left_join()</code> function to merge the Shannon index to the <code>weather</code> dataframe and create the data that you can use for a linear regression</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>tibble [3,239 × 6] (S3: tbl_df/tbl/data.frame)
 $ h.2019  : num [1:3239] 2.95 2.79 3.4 3.48 3.22 ...
 $ avgTemp : num [1:3239] 15 11 7 9.5 15 10.5 18.5 16 6 9 ...
 $ avgTime : num [1:3239] 7.06 6.62 7.3 6.98 7.15 6.66 7.14 7.6 7.4 6.64 ...
 $ avgWind : Ord.factor w/ 6 levels "0"&lt;"1"&lt;"2"&lt;"3"&lt;..: 3 3 3 1 2 2 3 2 5 3 ...
 $ StartSky: Factor w/ 6 levels "0","1","2","4",..: 2 3 1 2 2 1 3 3 2 2 ...
 $ Month   : Factor w/ 4 levels "4","5","6","7": 3 3 3 3 3 3 3 3 3 3 ...</code></pre>
</div>
</div>
<ul>
<li><strong>Task 5:</strong> fit the linear model to predict the Shannon index and use the <code>summary()</code> function</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = h.2019 ~ ., data = lm_data_shannon)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.51580 -0.20105  0.06916  0.28426  0.79719 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.914046   0.174736  10.954  &lt; 2e-16 ***
avgTemp      0.003934   0.001482   2.654  0.00798 ** 
avgTime      0.054966   0.013077   4.203 2.70e-05 ***
avgWind.L   -0.302392   0.125457  -2.410  0.01599 *  
avgWind.Q    0.008185   0.114168   0.072  0.94285    
avgWind.C    0.031908   0.084348   0.378  0.70524    
avgWind^4   -0.032388   0.054948  -0.589  0.55561    
avgWind^5   -0.044630   0.035465  -1.258  0.20833    
StartSky1   -0.022781   0.018411  -1.237  0.21605    
StartSky2   -0.022607   0.018498  -1.222  0.22173    
StartSky4    0.060261   0.043169   1.396  0.16284    
StartSky5   -0.054331   0.061050  -0.890  0.37356    
StartSky8   -0.239069   0.119332  -2.003  0.04522 *  
Month5       0.699587   0.146958   4.760 2.02e-06 ***
Month6       0.707523   0.145932   4.848 1.30e-06 ***
Month7       0.632867   0.147889   4.279 1.93e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4106 on 3223 degrees of freedom
Multiple R-squared:  0.04963,   Adjusted R-squared:  0.04521 
F-statistic: 11.22 on 15 and 3223 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li><strong>Task 6:</strong> interpret the output and compare it to the species richness model output. Is this different? Is it surprising?</li>
</ul>
<p><strong>Bonus:</strong> as said above, Shannon index is a summary of species richness and relative abundances. The latter can also be called <strong>evenness</strong>. Several ways to compute the evenness exist (<em>e.g.</em> gini index, Pielou index…). Here we will use the Pielou index <span class="math inline">\(J\)</span>, which formal definition is:</p>
<p><span class="math display">\[J = \frac{H}{log(R)}\]</span></p>
<p>Using the vegan package, you can compute it from the Shannon index <code>H</code> that you created just before as follow <code>J &lt;- H/specnumber(abundance2019)</code></p>
<p>Now, repeat the same task as above for the evenness index. Especially, map it and compare it to species richness and Shannon index.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="practical_week_5_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>